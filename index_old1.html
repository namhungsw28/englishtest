<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üêª English Fun Quiz for Kids üêù</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-b from-blue-100 to-pink-100 flex flex-col items-center min-h-screen p-6">
  <h1 class="text-4xl font-bold mb-8 text-pink-600 drop-shadow-lg">üêù English Fun Quiz üêù</h1>
  <div id="quiz" class="bg-white shadow-2xl rounded-3xl p-8 max-w-md w-full text-center transition-all duration-500"></div>

  <script>
    let questions = [];
    let current = 0;

    async function loadQuestions() {
      try {
        const res = await fetch("questions.json");
        questions = await res.json();
        showQuestion();
      } catch (err) {
        document.getElementById("quiz").innerHTML = "<p class='text-red-500'>‚ö†Ô∏è Cannot load questions!</p>";
      }
    }

    function showQuestion() {
      const q = questions[current];
      const div = document.getElementById('quiz');
      div.classList.remove('bg-green-100', 'bg-red-100');

      div.innerHTML = `<h2 class="text-xl font-semibold mb-4 text-gray-700">${q.question}</h2><div id="answers" class="space-y-3"></div>`;
      const answersDiv = document.getElementById('answers');

      if (q.type === "multiple") renderMultiple(q, answersDiv);
      else if (q.type === "fill") renderFill(q, answersDiv);
      else if (q.type === "truefalse") renderTrueFalse(q, answersDiv);
      else if (q.type === "match") renderMatch(q, answersDiv);
      else if (q.type === "imagechoice") renderImageChoice(q, answersDiv);
      else if (q.type === "listen") renderListen(q, answersDiv);
      else if (q.type === "translate") renderTranslate(q, answersDiv);
    }

    function renderMultiple(q, answersDiv) {
      q.options.forEach(opt => {
        const btn = document.createElement('button');
        btn.textContent = opt;
        btn.className = "block w-full py-2 rounded-xl bg-blue-200 hover:bg-blue-300 transition";
        btn.onclick = () => checkAnswer(opt, q.answer, btn);
        answersDiv.appendChild(btn);
      });
    }

    function renderFill(q, answersDiv) {
      answersDiv.innerHTML = `
        <input id="inputAnswer" class="border p-2 rounded-xl w-3/4 text-center" placeholder="Type your answer">
        <button onclick="checkAnswer(document.getElementById('inputAnswer').value, '${q.answer}', null)"
                class="bg-blue-300 px-4 py-2 rounded-xl ml-2 hover:bg-blue-400">Submit</button>`;
    }

    function renderTrueFalse(q, answersDiv) {
      ["True", "False"].forEach(opt => {
        const btn = document.createElement('button');
        btn.textContent = opt;
        btn.className = "block w-full py-2 rounded-xl bg-yellow-200 hover:bg-yellow-300 transition";
        btn.onclick = () => checkAnswer(opt, q.answer, btn);
        answersDiv.appendChild(btn);
      });
    }

    function renderMatch(q, answersDiv) {
      const words = Object.keys(q.pairs);
      const meanings = Object.values(q.pairs).sort(() => 0.5 - Math.random());

      words.forEach(word => {
        const select = document.createElement('select');
        select.className = "border rounded-xl p-2 w-full";
        select.innerHTML = "<option value=''>Select meaning</option>" +
          meanings.map(m => `<option value='${m}'>${m}</option>`).join('');
        const label = document.createElement('div');
        label.innerHTML = `<b>${word}</b>`;
        answersDiv.appendChild(label);
        answersDiv.appendChild(select);
      });

      const btn = document.createElement('button');
      btn.textContent = "Check";
      btn.className = "bg-blue-300 px-4 py-2 rounded-xl mt-3 hover:bg-blue-400";
      btn.onclick = () => {
        const selects = answersDiv.querySelectorAll('select');
        let correct = true;
        selects.forEach((s, i) => {
          const w = words[i];
          if (q.pairs[w] === s.value) s.classList.add("bg-green-100");
          else {
            s.classList.add("bg-red-100");
            correct = false;
          }
        });
        handleResult(correct);
      };
      answersDiv.appendChild(btn);
    }

    function renderImageChoice(q, answersDiv) {
      q.options.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = "flex flex-col items-center w-full bg-pink-100 hover:bg-pink-200 rounded-xl p-3";
        btn.innerHTML = `<img src="${opt.image}" class="w-24 h-24 mb-2"><span>${opt.text}</span>`;
        btn.onclick = () => checkAnswer(opt.text, q.answer, btn);
        answersDiv.appendChild(btn);
      });
    }

    function renderListen(q, answersDiv) {
      const audio = document.createElement('audio');
      audio.src = q.audio;
      audio.controls = true;
      audio.className = "mx-auto mb-3";
      answersDiv.appendChild(audio);
      renderMultiple(q, answersDiv);
    }

    function renderTranslate(q, answersDiv) {
      answersDiv.innerHTML = `
        <input id="inputAnswer" class="border p-2 rounded-xl w-3/4 text-center" placeholder="Type translation">
        <button onclick="checkAnswer(document.getElementById('inputAnswer').value, '${q.answer}', null)"
                class="bg-blue-300 px-4 py-2 rounded-xl ml-2 hover:bg-blue-400">Submit</button>`;
    }

    function checkAnswer(ans, correct, btn) {
      const normalized = ans.trim().toLowerCase();
      const right = correct.trim().toLowerCase();
      const div = document.getElementById('quiz');

      if (btn) {
        const buttons = document.querySelectorAll("#answers button");
        buttons.forEach(b => {
          b.disabled = true;
          if (b.textContent.toLowerCase() === right) b.classList.add("bg-green-300");
          else if (b.textContent.toLowerCase() === normalized && normalized !== right) b.classList.add("bg-red-300");
        });
      } else {
        const input = document.getElementById('inputAnswer');
        input.classList.add(normalized === right ? "bg-green-100" : "bg-red-100");
      }
      handleResult(normalized === right);
    }

    function handleResult(correct) {
      const div = document.getElementById('quiz');
      div.classList.add(correct ? 'bg-green-100' : 'bg-red-100');
      setTimeout(() => {
        current++;
        current < questions.length ? showQuestion() : showResult();
      }, 1000);
    }

    function showResult() {
      document.getElementById('quiz').innerHTML = `
        <h2 class="text-3xl text-pink-600 font-bold mb-2 animate-bounce">üéâ Great job! üéâ</h2>
        <p class="text-gray-700 mb-4">You finished all questions!</p>
        <button onclick="restart()" class="bg-yellow-300 px-4 py-2 rounded-xl hover:bg-yellow-400">Play Again</button>`;
    }

    function restart() {
      current = 0;
      showQuestion();
    }

    loadQuestions();
  </script>
</body>
</html>
